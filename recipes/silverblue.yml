---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
name: silverblue
description: Fedora Atomic

base-image: quay.io/fedora-ostree-desktops/silverblue
image-version: 43
alt-tags:
  - testing

modules:
  - type: files
    files:
      - source: system
        destination: /

  - type: bling
    install:
      - dconf-update-service

  - type: dnf
    repos:
      nonfree: rpmfusion
      files:
        - https://pkgs.tailscale.com/stable/fedora/tailscale.repo
    install:
      install-weak-deps: false
      packages:
        - android-tools
        - ddcutil
        - ffmpegthumbnailer
        - gcc
        - heif-pixbuf-loader
        - intel-media-driver
        - libheif-freeworld
        - opendoas
        - tailscale
        - https://github.com/trapexit/mergerfs/releases/download/2.40.2/mergerfs-2.40.2-1.fc42.x86_64.rpm
    remove:
      packages:
        - fedora-bookmarks
        - fedora-chromium-config
        - fedora-chromium-config-gnome
        - fedora-flathub-remote
        - fedora-repos-archive
        - fedora-third-party
        - fedora-workstation-repositories
        - firefox
        - firefox-langpacks
        - gnome-classic-session
        - gnome-shell-extension-apps-menu
        - gnome-shell-extension-background-logo
        - gnome-shell-extension-common
        - gnome-shell-extension-launch-new-instance
        - gnome-shell-extension-places-menu
        - gnome-shell-extension-window-list
        - gnome-software-rpm-ostree
        - gnome-system-monitor
        - gnome-tour
        - yelp
    replace:
      - from-repo: rpmfusion-free
        allow-erasing: true
        install-weak-deps: false
        packages:
          - new: ffmpeg
            old: ffmpeg-free
          - new: mesa-va-drivers-freeworld
            old: mesa-va-drivers

  - type: brew
    auto-update: true
    auto-upgrade: true
    brew-analytics: false

  - type: default-flatpaks
    configurations:
      - notify: false
        install:
          - app.drey.Damask
          - com.bitwarden.desktop
          - com.github.tchx84.Flatseal
          - com.mattjakeman.ExtensionManager
          - com.spotify.Client
          - io.bassi.Amberol
          - io.mpv.Mpv
          - md.obsidian.Obsidian
          - net.nokyan.Resources
          - org.gnome.Calculator
          - org.gnome.Calendar
          - org.gnome.clocks
          - org.gnome.Contacts
          - org.gnome.Loupe
          - org.gnome.NautilusPreviewer
          - org.gnome.Papers
          - org.gnome.Snapshot
          - org.gnome.TextEditor
          - org.gnome.Weather
          - org.localsend.localsend_app
          - org.mozilla.firefox
          - org.mozilla.Thunderbird
          - org.qbittorrent.qBittorrent
          - org.signal.Signal
          - org.gtk.Gtk3theme.Adwaita-dark

  - type: fonts
    fonts:
      nerd-fonts:
        - JetBrainsMono

  - type: systemd
    system:
      enabled:
        - autologin.service
        - rpm-ostreed-automatic.timer
        - tailscaled.service
      masked:
        - rpm-ostree-countme.service
        - rpm-ostree-countme.timer
    user:
      enabled:
        - homebrew-configure.service
        - firefox-theme-update.timer
        - firefox-userjs-update.timer
        - flatpak-user-update.timer
        - podman-auto-update.timer
        - podman.socket
        - ptyxis-reset-settings.service

  - type: gschema-overrides

  - type: gnome-extensions
    source: local
    install:
      - Alphabetical App Grid
      - Clipboard History
      - Hot Edge
      - Just Perfection
      - spotify-tray
      - Weather O'Clock

  - type: script
    scripts:
      - set-file-permissions.sh
      - fix-extension-version.sh

  - type: signing
